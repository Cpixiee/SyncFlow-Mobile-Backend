openapi: 3.0.3
info:
  title: SyncFlow - Quality Control & Measurement API
  description: |
    **SyncFlow** is a comprehensive quality control and measurement management system with advanced formula calculation capabilities.
    
    ## Features
    - üìä Product & Measurement Management
    - üßÆ Advanced Formula System (40+ mathematical functions)
    - üîß Tools & Instruments Management
    - üêõ Issue Tracking
    - üîê JWT-based Authentication with Role-based Access Control
    
    ## Authentication
    All protected endpoints require a JWT Bearer token in the Authorization header.
    Tokens can be obtained from the `/api/v1/login` endpoint.
    
    ## Roles
    - **user**: Basic access to measurements and viewing
    - **admin**: Can create products, tools, and issues
    - **superadmin**: Full system access including user management
    
    ## Response Format
    All endpoints return responses in the following format:
    ```json
    {
      "http_code": 200,
      "message": "Success message",
      "error_id": null,
      "data": { ... }
    }
    ```
    
    ## Error Codes
    - `VALIDATION_ERROR`: Request validation failed
    - `UNAUTHORIZED`: Authentication required
    - `FORBIDDEN`: Insufficient permissions
    - `NOT_FOUND`: Resource not found
    - `SERVER_ERROR`: Internal server error
    - `NO_ACTIVE_QUARTER`: No active quarter configured
    
  version: 1.1.0
  contact:
    name: SyncFlow API Support
    email: support@syncflow.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api
    description: Local development server
  - url: https://api.syncflow.com/api
    description: Production server

tags:
  - name: Authentication
    description: User authentication and account management
  - name: Products
    description: Product management and configuration
  - name: Product Categories
    description: Product category operations
  - name: Measurements
    description: Measurement data operations
  - name: Product Measurements
    description: Product measurement lifecycle management
  - name: Scale Measurements
    description: Daily weight tracking measurements
  - name: Measurement Instruments
    description: Measurement instrument management
  - name: Tools
    description: Tool/equipment management
  - name: Issues
    description: Issue tracking and collaboration
  - name: Notifications
    description: Notification management

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /api/v1/login endpoint

  schemas:
    # Common Schemas
    SuccessResponse:
      type: object
      properties:
        http_code:
          type: integer
          example: 200
        message:
          type: string
          example: Operation successful
        error_id:
          type: string
          nullable: true
          example: null
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        http_code:
          type: integer
          example: 400
        message:
          type: string
          example: Request invalid
        error_id:
          type: string
          example: VALIDATION_ERROR
        data:
          type: object
          nullable: true

    # Authentication Schemas
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          example: admin
        password:
          type: string
          format: password
          example: admin#1234

    LoginResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                token:
                  type: string
                  description: JWT access token
                user:
                  $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: admin
        role:
          type: string
          enum: [user, admin, superadmin]
          example: admin
        employee_id:
          type: string
          example: EMP-001
        phone:
          type: string
          example: '+628123456789'
        email:
          type: string
          format: email
          example: admin@syncflow.com
        position:
          type: string
          example: Quality Manager
        department:
          type: string
          example: Quality Control
        photo_url:
          type: string
          nullable: true
        password_changed:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateUserRequest:
      type: object
      required:
        - username
        - password
        - role
        - employee_id
      properties:
        username:
          type: string
          minLength: 3
          example: john_doe
        password:
          type: string
          format: password
          minLength: 6
          example: SecureP@ss123
        role:
          type: string
          enum: [user, admin, superadmin]
          example: user
        employee_id:
          type: string
          example: EMP-002
        phone:
          type: string
          example: '+628123456789'
        email:
          type: string
          format: email
          example: john@syncflow.com
        position:
          type: string
          example: QC Inspector
        department:
          type: string
          example: Quality Control
        photo_url:
          type: string
          nullable: true

    ChangePasswordRequest:
      type: object
      description: |
        Change password request. 
        - For user changing own password: requires current_password, new_password, new_password_confirmation
        - For admin resetting other user's password: requires target_user_id, new_password, new_password_confirmation (no current_password needed)
      properties:
        current_password:
          type: string
          format: password
          description: Required only when user changes own password (not for admin reset)
          example: "oldPassword123"
        new_password:
          type: string
          format: password
          minLength: 6
          description: New password (must be different from current)
          example: "newPassword123"
        new_password_confirmation:
          type: string
          format: password
          minLength: 6
          description: Confirmation of new password (must match new_password)
          example: "newPassword123"
        target_user_id:
          type: integer
          description: Required for admin/SuperAdmin resetting other user's password
          example: 5
        force_change:
          type: boolean
          description: Optional - if true, user must change password on next login (admin reset only)
          example: false

    # Product Schemas
    ProductBasicInfo:
      type: object
      required:
        - product_category_id
        - product_name
      properties:
        product_category_id:
          type: integer
          description: ID from /api/v1/products/categories endpoint
          example: 93
        product_name:
          type: string
          description: Must be in category's products array
          example: COTO
        ref_spec_number:
          type: string
          example: SPEC-001
        nom_size_vo:
          type: string
          example: 12mm
        article_code:
          type: string
          example: ART-001
        no_document:
          type: string
          example: DOC-001
        no_doc_reference:
          type: string
          example: REF-001
        color:
          type: string
          example: Blue
        size:
          type: string
          example: Medium

    MeasurementPointSetup:
      type: object
      required:
        - name
        - name_id
        - sample_amount
        - nature
      properties:
        name:
          type: string
          description: Display name for the measurement point
          example: Thickness Measurement
        name_id:
          type: string
          description: Unique identifier (alphanumeric + underscore)
          pattern: '^[a-zA-Z0-9_]+$'
          example: thickness_a
        sample_amount:
          type: integer
          minimum: 1
          example: 3
        source:
          type: string
          enum: [MANUAL, INSTRUMENT, TOOL, DERIVED]
          description: Required for QUANTITATIVE measurements
          example: INSTRUMENT
        source_instrument_id:
          type: integer
          description: Required if source = INSTRUMENT
          example: 1
        source_tool_model:
          type: string
          description: Required if source = TOOL
          example: MITUTOYO-CD-15CPX
        source_derived_name_id:
          type: string
          description: Required if source = DERIVED (references another measurement item)
          example: thickness_a
        type:
          type: string
          enum: [SINGLE, BEFORE_AFTER]
          description: Required for QUANTITATIVE measurements
          example: SINGLE
        nature:
          type: string
          enum: [QUANTITATIVE, QUALITATIVE]
          example: QUANTITATIVE

    Variable:
      type: object
      required:
        - type
        - name
      properties:
        type:
          type: string
          enum: [FIXED, MANUAL, FORMULA]
          example: FORMULA
        name:
          type: string
          example: calculated_value
        value:
          type: number
          description: Required if type = FIXED
          example: 0.1
        formula:
          type: string
          description: Required if type = FORMULA (must start with =)
          example: '=avg(thickness_a)'
        is_show:
          type: boolean
          example: true

    RuleEvaluationSetting:
      type: object
      required:
        - rule
        - unit
        - value
      properties:
        rule:
          type: string
          enum: [MIN, MAX, BETWEEN]
          example: BETWEEN
        unit:
          type: string
          example: mm
        value:
          type: number
          example: 2.5
        tolerance_minus:
          type: number
          description: Required if rule = BETWEEN
          example: 0.1
        tolerance_plus:
          type: number
          description: Required if rule = BETWEEN
          example: 0.1

    MeasurementPoint:
      type: object
      required:
        - setup
        - evaluation_type
        - evaluation_setting
      properties:
        setup:
          $ref: '#/components/schemas/MeasurementPointSetup'
        variables:
          type: array
          items:
            $ref: '#/components/schemas/Variable'
          nullable: true
        pre_processing_formulas:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              formula:
                type: string
          nullable: true
        evaluation_type:
          type: string
          enum: [PER_SAMPLE, JOINT, SKIP_CHECK]
          example: PER_SAMPLE
        evaluation_setting:
          type: object
          properties:
            per_sample_setting:
              type: object
              properties:
                is_raw_data:
                  type: boolean
                  example: true
                pre_processing_formula_name:
                  type: string
                  nullable: true
            joint_setting:
              type: object
              nullable: true
            qualitative_setting:
              type: object
              nullable: true
        rule_evaluation_setting:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/RuleEvaluationSetting'

    CreateProductRequest:
      type: object
      required:
        - basic_info
        - measurement_points
      properties:
        basic_info:
          $ref: '#/components/schemas/ProductBasicInfo'
        measurement_points:
          type: array
          items:
            $ref: '#/components/schemas/MeasurementPoint'
        measurement_groups:
          type: array
          items:
            type: object
          nullable: true

    Product:
      type: object
      properties:
        id:
          type: integer
          example: 1
        product_id:
          type: string
          example: PRD-ABC123XY
        quarter_id:
          type: integer
          example: 1
        basic_info:
          $ref: '#/components/schemas/ProductBasicInfo'
        measurement_points:
          type: array
          items:
            $ref: '#/components/schemas/MeasurementPoint'
        measurement_groups:
          type: array
          nullable: true
        product_category:
          $ref: '#/components/schemas/ProductCategory'
        quarter:
          type: object
          properties:
            id:
              type: integer
            year:
              type: integer
            quarter:
              type: string
            is_active:
              type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Product Category Schemas
    ProductCategory:
      type: object
      properties:
        id:
          type: integer
          example: 93
        name:
          type: string
          example: Tube Test
        products:
          type: array
          items:
            type: string
          example: [VO, COTO, COT, COTO-FR]
        description:
          type: string
          example: Kategori untuk testing tube

    # Measurement Instrument Schemas
    MeasurementInstrument:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Digital Caliper
        model:
          type: string
          example: DC-150
        serial_number:
          type: string
          example: DC001-2024
        manufacturer:
          type: string
          example: Mitutoyo
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          example: ACTIVE
        description:
          type: string
          example: High precision digital caliper
        display_name:
          type: string
          example: Digital Caliper (DC001-2024)
        needs_calibration:
          type: boolean
          example: true
        last_calibration:
          type: string
          format: date
          example: '2024-01-15'
        next_calibration:
          type: string
          format: date
          example: '2025-01-15'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Tool Schemas
    Tool:
      type: object
      properties:
        id:
          type: integer
          example: 1
        tool_name:
          type: string
          example: Digital Caliper Pro
        tool_model:
          type: string
          example: MITUTOYO-CD-15CPX
        imei:
          type: string
          example: IME-001-2024
        tool_type:
          type: string
          enum: [OPTICAL, MECHANICAL]
          example: OPTICAL
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          example: ACTIVE
        calibration_date:
          type: string
          format: date
          example: '2024-01-15'
        next_calibration_date:
          type: string
          format: date
          example: '2025-01-15'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateToolRequest:
      type: object
      required:
        - tool_name
        - tool_model
        - imei
        - tool_type
        - calibration_date
      properties:
        tool_name:
          type: string
          example: Digital Caliper Pro
        tool_model:
          type: string
          example: MITUTOYO-CD-15CPX
        imei:
          type: string
          example: IME-001-2024
        tool_type:
          type: string
          enum: [OPTICAL, MECHANICAL]
          example: OPTICAL
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          default: ACTIVE
        calibration_date:
          type: string
          format: date
          example: '2024-01-15'

    # Issue Schemas
    Issue:
      type: object
      properties:
        id:
          type: integer
          example: 1
        issue_name:
          type: string
          example: Calibration Overdue
        description:
          type: string
          example: Multiple instruments require calibration
        status:
          type: string
          enum: [PENDING, ON_GOING, SOLVED]
          example: PENDING
        due_date:
          type: string
          format: date
          example: '2024-12-31'
        created_by:
          type: integer
          example: 1
        comments_count:
          type: integer
          example: 5
        creator:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
            employee_id:
              type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateIssueRequest:
      type: object
      required:
        - issue_name
        - description
        - due_date
      properties:
        issue_name:
          type: string
          example: Calibration Overdue
        description:
          type: string
          example: Multiple instruments require calibration
        status:
          type: string
          enum: [PENDING, ON_GOING, SOLVED]
          default: PENDING
        due_date:
          type: string
          format: date
          example: '2024-12-31'

    IssueComment:
      type: object
      properties:
        id:
          type: integer
          example: 1
        issue_id:
          type: integer
          example: 1
        comment:
          type: string
          example: Working on this issue
        user:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
            employee_id:
              type: string
        created_at:
          type: string
          format: date-time

    CreateCommentRequest:
      type: object
      required:
        - comment
      properties:
        comment:
          type: string
          example: Working on this issue

    # Scale Measurement Schemas
    ScaleMeasurement:
      type: object
      properties:
        scale_measurement_id:
          type: string
          example: "SCL-X1Y2Z3A4"
        product_id:
          type: string
          example: "PRD-A1B2C3D4"
        measurement_date:
          type: string
          format: date
          example: "2025-12-02"
        weight:
          type: number
          format: float
          nullable: true
          example: 4.5
        status:
          type: string
          enum: [NOT_CHECKED, CHECKED]
          example: "CHECKED"
        notes:
          type: string
          nullable: true
        product:
          type: object
          properties:
            id:
              type: string
            product_name:
              type: string
            product_category_name:
              type: string
            article_code:
              type: string
        measured_by:
          type: object
          nullable: true
          properties:
            username:
              type: string
            employee_id:
              type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Notification Schemas
    Notification:
      type: object
      properties:
        id:
          type: integer
        type:
          type: string
        title:
          type: string
        message:
          type: string
        read_at:
          type: string
          format: date-time
          nullable: true
        data:
          type: object
          nullable: true
        created_at:
          type: string
          format: date-time

    # Product Measurement Schemas
    ProductMeasurement:
      type: object
      properties:
        id:
          type: integer
          example: 1
        measurement_id:
          type: string
          example: "MSR-ABC123XY"
        product_id:
          type: integer
          example: 1
        measurement_type:
          type: string
          enum: [FULL_MEASUREMENT, SCALE_MEASUREMENT]
          example: FULL_MEASUREMENT
        due_date:
          type: string
          format: date-time
          nullable: true
          example: '2024-12-31 00:00:00'
        status:
          type: string
          enum: [TODO, PENDING, IN_PROGRESS, COMPLETED, CANCELLED]
          example: IN_PROGRESS
        sample_status:
          type: string
          enum: [OK, NG, NOT_COMPLETE]
          example: NOT_COMPLETE
        overall_result:
          type: boolean
          nullable: true
          description: Overall OK/NG result (true = OK, false = NG)
        batch_number:
          type: string
          nullable: true
          example: "BATCH-2024-001"
        sample_count:
          type: integer
          example: 3
        measurement_results:
          type: array
          nullable: true
          items:
            type: object
            properties:
              measurement_item_name_id:
                type: string
              status:
                type: boolean
              variable_values:
                type: array
              samples:
                type: array
                nullable: true
              joint_setting_formula_values:
                type: array
                nullable: true
              created_at:
                type: string
                format: date-time
              updated_at:
                type: string
                format: date-time
              submitted_at:
                type: string
                format: date-time
                nullable: true
                description: Timestamp when submitted (only present after submit)
        last_check_data:
          type: object
          nullable: true
          description: Last check data (jejak) for validation
        product:
          $ref: '#/components/schemas/Product'
        measured_by:
          type: object
          nullable: true
        measured_at:
          type: string
          format: date-time
          nullable: true
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateProductMeasurementRequest:
      type: object
      required:
        - product_id
        - measurement_type
        - due_date
      properties:
        product_id:
          type: integer
          example: 1
        measurement_type:
          type: string
          enum: [FULL_MEASUREMENT, SCALE_MEASUREMENT]
          example: FULL_MEASUREMENT
        due_date:
          type: string
          format: date
          example: '2024-12-31'

paths:
  # Authentication Endpoints
  /v1/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and get JWT token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                http_code: 200
                message: Login berhasil
                error_id: null
                data:
                  token: eyJ0eXAiOiJKV1QiLCJhbGc...
                  user:
                    id: 1
                    username: admin
                    role: admin
                    employee_id: EMP-001
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Invalidate current JWT token
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /v1/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh JWT token
      description: Get a new JWT token using current token
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Token refreshed successfully
                  error_id:
                    type: string
                    nullable: true
                  data:
                    type: object
                    properties:
                      token:
                        type: string

  /v1/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get authenticated user information
      responses:
        '200':
          description: User information retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  error_id:
                    type: string
                    nullable: true
                  data:
                    $ref: '#/components/schemas/User'

  /v1/change-password:
    post:
      tags:
        - Authentication
      summary: Change password
      description: |
        Change user password. Supports two modes:
        1. **User changing own password**: Requires current_password, new_password, new_password_confirmation
        2. **Admin/SuperAdmin resetting other user's password**: Requires target_user_id, new_password, new_password_confirmation (no current_password needed)
        
        Optional `force_change` parameter (admin only): If true, user must change password on next login.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
            examples:
              user_own_password:
                summary: User changing own password
                value:
                  current_password: "oldPassword123"
                  new_password: "newPassword123"
                  new_password_confirmation: "newPassword123"
              admin_reset:
                summary: Admin resetting user password
                value:
                  target_user_id: 5
                  new_password: "tempPassword123"
                  new_password_confirmation: "tempPassword123"
                  force_change: true
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                http_code: 200
                message: "Password changed successfully"
                error_id: null
                data:
                  id: 5
                  user_id: 5
                  username: "user123"
                  role: "operator"
                  must_change_password: false
                  password_changed_at: "2025-12-18 15:30:00"
                  is_force_change: false
                  changed_by_admin: false
        '400':
          description: Validation error (wrong current password, new password same as current, etc.)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '404':
          description: Target user not found (for admin reset)

  /v1/update-user:
    put:
      tags:
        - Authentication
      summary: Update user information
      description: Update current user information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phone:
                  type: string
                email:
                  type: string
                position:
                  type: string
                department:
                  type: string
                photo_url:
                  type: string
      responses:
        '200':
          description: User updated successfully

  /v1/create-user:
    post:
      tags:
        - Authentication
      summary: Create new user (SuperAdmin only)
      description: Create a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 201
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/User'

  /v1/get-user-list:
    get:
      tags:
        - Authentication
      summary: Get user list (SuperAdmin only)
      description: Get list of all users with pagination
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Users retrieved successfully

  /v1/delete-users:
    delete:
      tags:
        - Authentication
      summary: Delete users (SuperAdmin only)
      description: Delete one or multiple users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_ids
              properties:
                user_ids:
                  type: array
                  items:
                    type: integer
                  example: [2, 3, 4]
      responses:
        '200':
          description: Users deleted successfully

  # Product Endpoints
  /v1/products:
    post:
      tags:
        - Products
      summary: Create new product (Admin/SuperAdmin only)
      description: Create a new product with measurement points
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: Product berhasil dibuat
                  data:
                    $ref: '#/components/schemas/Product'
        '400':
          description: Validation error or no active quarter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - Products
      summary: Get products list (Admin/SuperAdmin only)
      description: Get paginated list of products with optional filters
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Items per page
        - name: product_category_id
          in: query
          required: false
          schema:
            type: integer
          description: Filter by product category ID (optional)
        - name: search
          in: query
          schema:
            type: string
          description: Search by product name
      responses:
        '200':
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      products:
                        type: array
                        items:
                          $ref: '#/components/schemas/Product'
                      pagination:
                        type: object

  /v1/products/{productId}:
    get:
      tags:
        - Products
      summary: Get product by ID (Admin/SuperAdmin only)
      description: Get detailed product information
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Product'

    put:
      tags:
        - Products
      summary: Update product (Admin/SuperAdmin only)
      description: Update an existing product with partial update support
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
          description: Product ID to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                basic_info:
                  type: object
                  properties:
                    product_category_id:
                      type: integer
                    product_name:
                      type: string
                    ref_spec_number:
                      type: string
                      nullable: true
                    nom_size_vo:
                      type: string
                      nullable: true
                    article_code:
                      type: string
                      nullable: true
                    no_document:
                      type: string
                      nullable: true
                    no_doc_reference:
                      type: string
                      nullable: true
                    color:
                      type: string
                      nullable: true
                    size:
                      type: string
                      nullable: true
                measurement_points:
                  type: array
                  description: Optional - update measurement points
                measurement_groups:
                  type: array
                  description: Optional - update measurement groups
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Products
      summary: Delete product (Admin/SuperAdmin only)
      description: Delete a product (only if it has no measurement data)
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
          description: Product ID to delete
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      deleted:
                        type: boolean
        '400':
          description: Product has measurements and cannot be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/products/is-product-exists:
    get:
      tags:
        - Products
      summary: Check if product exists (Admin/SuperAdmin only)
      description: |
        Check if a product with same basic info already exists.
        All fields are compared - a product is considered the same if ALL field values match (including null values).
      parameters:
        - name: product_category_id
          in: query
          required: true
          schema:
            type: integer
          description: Product category ID
        - name: product_name
          in: query
          required: true
          schema:
            type: string
          description: Product name
        - name: ref_spec_number
          in: query
          required: false
          schema:
            type: string
          description: Reference specification number (nullable)
        - name: nom_size_vo
          in: query
          required: false
          schema:
            type: string
          description: Nominal size VO (nullable)
        - name: article_code
          in: query
          required: false
          schema:
            type: string
          description: Article code (nullable)
        - name: no_document
          in: query
          required: false
          schema:
            type: string
          description: Document number (nullable)
        - name: no_doc_reference
          in: query
          required: false
          schema:
            type: string
          description: Document reference number (nullable)
        - name: color
          in: query
          required: false
          schema:
            type: string
            pattern: '^#?[0-9A-Fa-f]{6}$'
          description: Product color in HEX format (nullable)
        - name: size
          in: query
          required: false
          schema:
            type: string
          description: Product size (nullable)
      responses:
        '200':
          description: Check completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      exists:
                        type: boolean

  /v1/products/categories:
    get:
      tags:
        - Products
      summary: Get product categories (Admin/SuperAdmin only)
      description: Get list of all product categories
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductCategory'

  /v1/products/from-existing:
    post:
      tags:
        - Products
      summary: Create product from existing product (Admin/SuperAdmin only)
      description: Create a new product by copying configuration from an existing product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - source_product_id
                - basic_info
              properties:
                source_product_id:
                  type: string
                  description: Product ID to copy from
                  example: "PRD-ABC123XY"
                basic_info:
                  $ref: '#/components/schemas/ProductBasicInfo'
                measurement_points:
                  type: array
                  description: Optional - override measurement points
                measurement_groups:
                  type: array
                  description: Optional - override measurement groups
      responses:
        '201':
          description: Product created successfully
  /v1/products/master-products:
    get:
      tags:
        - Products
      summary: Get master products list
      description: Get list of master products that haven't been created yet (available for all authenticated users)
      parameters:
        - name: product_category_id
          in: query
          schema:
            type: integer
          description: Filter by product category ID
        - name: query
          in: query
          schema:
            type: string
          description: Search query
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Master products retrieved successfully
  /v1/products/{productId}/measurement-items/suggest:
    get:
      tags:
        - Products
      summary: Get measurement item suggestions
      description: Autocomplete endpoint for formula suggestions
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
        - name: query
          in: query
          schema:
            type: string
          description: Search query for autocomplete
      responses:
        '200':
          description: Suggestions retrieved successfully

  # Product Category Endpoints
  /v1/product-categories:
    get:
      tags:
        - Product Categories
      summary: Get product categories
      description: Get list of all product categories
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductCategory'

  /v1/product-categories/search-products:
    get:
      tags:
        - Product Categories
      summary: Search products in categories
      description: Search for products across categories
      parameters:
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Search completed

  /v1/product-categories/structure:
    get:
      tags:
        - Product Categories
      summary: Get category structure
      description: Get hierarchical category structure
      responses:
        '200':
          description: Structure retrieved

  /v1/product-categories/{categoryId}/products:
    get:
      tags:
        - Product Categories
      summary: Get products by category
      description: Get all products in a specific category
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Products retrieved

  # Measurement Instrument Endpoints
  /v1/measurement-instruments:
    get:
      tags:
        - Measurement Instruments
      summary: Get all measurement instruments
      description: Get list of all measurement instruments
      responses:
        '200':
          description: Instruments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      instruments:
                        type: array
                        items:
                          $ref: '#/components/schemas/MeasurementInstrument'

  /v1/measurement-instruments/{instrumentId}:
    get:
      tags:
        - Measurement Instruments
      summary: Get instrument by ID
      description: Get detailed instrument information
      parameters:
        - name: instrumentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Instrument retrieved successfully

  # Tool Endpoints
  /v1/tools:
    get:
      tags:
        - Tools
      summary: Get tools list
      description: Get paginated list of tools
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: status
          in: query
          schema:
            type: string
            enum: [ACTIVE, INACTIVE]
        - name: tool_model
          in: query
          schema:
            type: string
        - name: tool_type
          in: query
          schema:
            type: string
            enum: [OPTICAL, MECHANICAL]
        - name: search
          in: query
          schema:
            type: string
          description: Search by tool_name, tool_model, or imei
      responses:
        '200':
          description: Tools retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      tools:
                        type: array
                        items:
                          $ref: '#/components/schemas/Tool'
                      pagination:
                        type: object

    post:
      tags:
        - Tools
      summary: Create new tool (Admin/SuperAdmin only)
      description: Create a new tool/equipment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateToolRequest'
      responses:
        '201':
          description: Tool created successfully

  /v1/tools/models:
    get:
      tags:
        - Tools
      summary: Get tool models
      description: Get list of unique tool models (ACTIVE tools only)
      responses:
        '200':
          description: Models retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      models:
                        type: array
                        items:
                          type: string
                        example: [MITUTOYO-CD-15CPX, BOSCH-GLM-50]

  /v1/tools/by-model:
    get:
      tags:
        - Tools
      summary: Get tools by model
      description: Get all tools with specific model (for IMEI selection)
      parameters:
        - name: tool_model
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tools retrieved successfully

  /v1/tools/{id}:
    get:
      tags:
        - Tools
      summary: Get tool by ID
      description: Get detailed tool information
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tool retrieved successfully

    put:
      tags:
        - Tools
      summary: Update tool (Admin/SuperAdmin only)
      description: Update existing tool information
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateToolRequest'
      responses:
        '200':
          description: Tool updated successfully

    delete:
      tags:
        - Tools
      summary: Delete tool (Admin/SuperAdmin only)
      description: Delete a tool
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tool deleted successfully

  # Issue Endpoints
  /v1/issues:
    get:
      tags:
        - Issues
      summary: Get issues list
      description: Get paginated list of issues
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ON_GOING, SOLVED]
        - name: search
          in: query
          schema:
            type: string
          description: Search by issue_name or description
      responses:
        '200':
          description: Issues retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      issues:
                        type: array
                        items:
                          $ref: '#/components/schemas/Issue'
                      pagination:
                        type: object

    post:
      tags:
        - Issues
      summary: Create new issue (Admin/SuperAdmin only)
      description: Create a new issue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIssueRequest'
      responses:
        '201':
          description: Issue created successfully

  /v1/issues/{id}:
    get:
      tags:
        - Issues
      summary: Get issue by ID
      description: Get detailed issue information with comments
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Issue retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      issue:
                        $ref: '#/components/schemas/Issue'
                      comments:
                        type: array
                        items:
                          $ref: '#/components/schemas/IssueComment'

    put:
      tags:
        - Issues
      summary: Update issue (Admin/SuperAdmin only)
      description: Update existing issue
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIssueRequest'
      responses:
        '200':
          description: Issue updated successfully

    delete:
      tags:
        - Issues
      summary: Delete issue (Admin/SuperAdmin only)
      description: Delete an issue
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Issue deleted successfully

  /v1/issues/{id}/comments:
    get:
      tags:
        - Issues
      summary: Get issue comments
      description: Get all comments for an issue
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Comments retrieved successfully

    post:
      tags:
        - Issues
      summary: Add comment to issue
      description: Add a comment to an issue (all authenticated users)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
      responses:
        '201':
          description: Comment added successfully

  /v1/issues/{issueId}/comments/{commentId}:
    delete:
      tags:
        - Issues
      summary: Delete comment
      description: Delete a comment (only comment owner, admin, or superadmin)
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: integer
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Comment deleted successfully

  # Scale Measurement Endpoints
  /v1/scale-measurement:
    get:
      tags:
        - Scale Measurements
      summary: Get scale measurements list
      description: Get paginated list of scale measurements (daily weight tracking) with optional filters
      parameters:
        - name: date
          in: query
          schema:
            type: string
            format: date
          description: Filter by specific date (YYYY-MM-DD)
        - name: start_date
          in: query
          schema:
            type: string
            format: date
          description: Filter range start date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
          description: Filter range end date
        - name: status
          in: query
          schema:
            type: string
            enum: [NOT_CHECKED, CHECKED]
          description: Filter by status
        - name: product_category_id
          in: query
          schema:
            type: integer
          description: Filter by product category
        - name: query
          in: query
          schema:
            type: string
          description: Search by product name/code
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Scale measurements retrieved successfully
    post:
      tags:
        - Scale Measurements
      summary: Create scale measurement (All users - Operator can create)
      description: Create a new scale measurement for a product. Operator can create.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - product_id
                - measurement_date
              properties:
                product_id:
                  type: string
                  example: "PRD-A1B2C3D4"
                measurement_date:
                  type: string
                  format: date
                  example: "2025-12-02"
                weight:
                  type: number
                  format: float
                  minimum: 0
                  description: Optional - if provided, status becomes CHECKED
                  example: 4.5
                notes:
                  type: string
                  example: "Pengukuran pagi"
      responses:
        '201':
          description: Scale measurement created successfully
  /v1/scale-measurement/bulk:
    post:
      tags:
        - Scale Measurements
      summary: Bulk create scale measurements (All users - Operator can create)
      description: Create multiple scale measurements at once without weight (status = NOT_CHECKED)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - product_ids
                - measurement_date
              properties:
                product_ids:
                  type: array
                  items:
                    type: string
                  example: ["PRD-001", "PRD-002", "PRD-003"]
                measurement_date:
                  type: string
                  format: date
                  example: "2025-12-02"
      responses:
        '201':
          description: Bulk scale measurements created successfully
  /v1/scale-measurement/available-products:
    get:
      tags:
        - Scale Measurements
      summary: Get available products for scale measurement
      description: Get products that don't have scale measurement for the specified date
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
          description: Date to check (YYYY-MM-DD)
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Available products retrieved successfully
  /v1/scale-measurement/{scaleMeasurementId}:
    get:
      tags:
        - Scale Measurements
      summary: Get scale measurement by ID
      description: Get detailed scale measurement information
      parameters:
        - name: scaleMeasurementId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Scale measurement retrieved successfully
    put:
      tags:
        - Scale Measurements
      summary: Update scale measurement (Admin/SuperAdmin only)
      description: Update scale measurement weight and notes. Operator cannot update.
      parameters:
        - name: scaleMeasurementId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                weight:
                  type: number
                  format: float
                  minimum: 0
                  example: 5.2
                notes:
                  type: string
                  example: "Updated measurement"
      responses:
        '200':
          description: Scale measurement updated successfully
        '403':
          description: Forbidden - Operator cannot update
    delete:
      tags:
        - Scale Measurements
      summary: Delete scale measurement (Admin/SuperAdmin only)
      description: Delete a scale measurement. Operator cannot delete.
      parameters:
        - name: scaleMeasurementId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Scale measurement deleted successfully
        '403':
          description: Forbidden - Operator cannot delete

  # Product Measurement Endpoints
  /v1/product-measurement/progress:
    get:
      tags:
        - Product Measurements
      summary: Get measurement progress
      description: Get overall progress statistics for measurements
      parameters:
        - name: quarter
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 4
        - name: year
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Progress retrieved successfully
  /v1/product-measurement/progress-category:
    get:
      tags:
        - Product Measurements
      summary: Get progress by category
      description: Get measurement progress grouped by product category
      parameters:
        - name: quarter
          in: query
          schema:
            type: integer
        - name: year
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Category progress retrieved successfully
  /v1/product-measurement/progress-all:
    get:
      tags:
        - Product Measurements
      summary: Get all progress data
      description: Get comprehensive progress data for all measurements
      parameters:
        - name: quarter
          in: query
          schema:
            type: integer
        - name: year
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: All progress data retrieved successfully
  /v1/product-measurement/by-product:
    get:
      tags:
        - Product Measurements
      summary: Get measurements by product
      description: Get all measurements for a specific product
      parameters:
        - name: product_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Measurements retrieved successfully
  /v1/product-measurement/available-products:
    get:
      tags:
        - Product Measurements
      summary: Get available products for monthly target
      description: Get products that don't have measurement target in the specified quarter/year
      parameters:
        - name: quarter
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 4
          description: Quarter number (1-4)
        - name: year
          in: query
          required: true
          schema:
            type: integer
            minimum: 2020
            maximum: 2100
          description: Year
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Items per page
      responses:
        '200':
          description: Available products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      docs:
                        type: array
                        items:
                          $ref: '#/components/schemas/Product'
                      metadata:
                        type: object
                        properties:
                          current_page:
                            type: integer
                          total_page:
                            type: integer
                          limit:
                            type: integer
                          total_docs:
                            type: integer

  /v1/product-measurement:
    get:
      tags:
        - Product Measurements
      summary: Get product measurements list
      description: Get paginated list of product measurements with optional filters
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Items per page
        - name: quarter
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 4
          description: Filter by quarter number (1-4)
        - name: year
          in: query
          required: false
          schema:
            type: integer
            minimum: 2020
            maximum: 2100
          description: Filter by year
        - name: product_id
          in: query
          schema:
            type: integer
          description: Filter by product ID
        - name: product_category_id
          in: query
          schema:
            type: integer
          description: Filter by product category ID
        - name: measurement_type
          in: query
          schema:
            type: string
            enum: [FULL_MEASUREMENT, SCALE_MEASUREMENT]
          description: Filter by measurement type
        - name: status
          in: query
          schema:
            type: string
            enum: [TODO, ONGOING, NEED_TO_MEASURE, OK, NG, NOT_COMPLETE]
          description: Filter by status
        - name: query
          in: query
          schema:
            type: string
          description: Search by product name, article code, etc.
      responses:
        '200':
          description: Measurements retrieved successfully

    post:
      tags:
        - Product Measurements
      summary: Create new measurement
      description: |
        Create a new measurement entry for a product. 
        Supports both single product (product_id) and multiple products (product_ids).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                product_id:
                  type: string
                  description: Single product ID (use with product_ids)
                  example: "PRD-ABC123XY"
                product_ids:
                  type: array
                  items:
                    type: string
                  description: Multiple product IDs (alternative to product_id)
                  example: ["PRD-001", "PRD-002"]
                due_date:
                  type: string
                  format: date
                  required: true
                  example: "2024-12-31"
                measurement_type:
                  type: string
                  enum: [FULL_MEASUREMENT, SCALE_MEASUREMENT]
                  required: true
                  example: FULL_MEASUREMENT
                batch_number:
                  type: string
                  nullable: true
                  description: Optional batch number (auto-generated if not provided)
                sample_count:
                  type: integer
                  nullable: true
                  description: Optional sample count
                notes:
                  type: string
                  nullable: true
      responses:
        '201':
          description: Measurement created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: "Measurement entry created successfully"
                  data:
                    oneOf:
                      - type: object
                        properties:
                          product_measurement_id:
                            type: string
                            example: "MSR-ABC123XY"
                        description: Single product response
                      - type: object
                        additionalProperties:
                          type: string
                        description: Multiple products response (map of product_id to measurement_id)
                        example:
                          "PRD-001": "MSR-ABC123"
                          "PRD-002": "MSR-DEF456"

  /v1/product-measurement/bulk:
    post:
      tags:
        - Product Measurements
      summary: Bulk create measurements
      description: Create measurements for multiple products at once
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - product_ids
                - due_date
                - measurement_type
              properties:
                product_ids:
                  type: array
                  items:
                    type: string
                  description: Array of product IDs
                  example: ["PRD-001", "PRD-002", "PRD-003"]
                due_date:
                  type: string
                  format: date
                  example: "2024-12-31"
                measurement_type:
                  type: string
                  enum: [FULL_MEASUREMENT, SCALE_MEASUREMENT]
                  example: FULL_MEASUREMENT
                batch_number:
                  type: string
                  nullable: true
                  description: Optional batch number (auto-generated if not provided)
                sample_count:
                  type: integer
                  nullable: true
                  description: Optional sample count
                notes:
                  type: string
                  nullable: true
      responses:
        '201':
          description: Bulk measurements created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: "Measurement entries created successfully"
                  data:
                    type: object
                    description: Map of product_id to measurement_id
                    additionalProperties:
                      type: string
                    example:
                      "PRD-001": "MSR-ABC123"
                      "PRD-002": "MSR-DEF456"
                      "PRD-003": "MSR-GHI789"

  /v1/product-measurement/{productMeasurementId}:
    get:
      tags:
        - Product Measurements
      summary: Get measurement by ID
      description: Get detailed measurement information
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Measurement retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/ProductMeasurement'
    put:
      tags:
        - Product Measurements
      summary: Update measurement
      description: Update measurement information
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                due_date:
                  type: string
                  format: date
                batch_number:
                  type: string
                notes:
                  type: string
      responses:
        '200':
          description: Measurement updated successfully
    delete:
      tags:
        - Product Measurements
      summary: Delete measurement
      description: Delete a measurement (Admin only)
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Measurement deleted successfully

  /v1/product-measurement/{productMeasurementId}/set-batch-number:
    post:
      tags:
        - Product Measurements
      summary: Set batch number
      description: Set batch number and move status to IN_PROGRESS
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - batch_number
              properties:
                batch_number:
                  type: string
                  example: "BATCH-2024-001"
      responses:
        '200':
          description: Batch number set successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /v1/product-measurement/{productMeasurementId}/samples/check:
    post:
      tags:
        - Product Measurements
      summary: Check and validate samples
      description: |
        Validate and evaluate samples for a specific measurement item.
        
        **IMPORTANT:**
        - This endpoint does NOT save data to measurement_results (DB)
        - It ONLY saves to last_check_data (jejak) for future comparison
        - Used for calculation and validation before save-progress
        
        **Side Effects:**
        - Updates last_check_data field with calculation results
        - This "jejak" is used by /save-progress for validation
        
        **When to use:**
        - Every time user measures/changes raw data
        - Before calling /save-progress
        - When re-validating after data changes
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
          description: Product measurement ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - measurement_item_name_id
              properties:
                measurement_item_name_id:
                  type: string
                  description: Measurement item name ID
                  example: "thickness_a"
                samples:
                  type: array
                  nullable: true
                  description: Sample measurements (nullable for sample_amount = 0)
                  items:
                    type: object
                    required:
                      - sample_index
                    properties:
                      sample_index:
                        type: integer
                        minimum: 1
                        example: 1
                      single_value:
                        type: number
                        nullable: true
                        description: For SINGLE type evaluation
                        example: 10.5
                      before_after_value:
                        type: object
                        nullable: true
                        description: For BEFORE_AFTER type evaluation
                        properties:
                          before:
                            type: number
                            example: 5.2
                          after:
                            type: number
                            example: 10.8
                      qualitative_value:
                        type: boolean
                        nullable: true
                        description: For QUALITATIVE nature evaluation
                        example: true
                variable_values:
                  type: array
                  nullable: true
                  description: Manual variable values (optional)
                  items:
                    type: object
                    required:
                      - name_id
                      - value
                    properties:
                      name_id:
                        type: string
                        example: "panjang"
                      value:
                        type: number
                        example: 150
            examples:
              single_value:
                summary: Single value measurement
                value:
                  measurement_item_name_id: "thickness_a"
                  samples:
                    - sample_index: 1
                      single_value: 10
                    - sample_index: 2
                      single_value: 10
                    - sample_index: 3
                      single_value: 10
              with_formula:
                summary: Measurement with formula dependencies
                value:
                  measurement_item_name_id: "room_temp"
                  samples:
                    - sample_index: 1
                      single_value: 25.5
                    - sample_index: 2
                      single_value: 25.3
                    - sample_index: 3
                      single_value: 25.7
      responses:
        '200':
          description: Samples checked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Samples processed successfully"
                  error_id:
                    type: string
                    nullable: true
                  data:
                    type: object
                    properties:
                      measurement_item_name_id:
                        type: string
                        example: "thickness_a"
                      status:
                        type: boolean
                        description: Overall status (true = OK, false = NG)
                        example: true
                      samples:
                        type: array
                        description: Validated samples with status
                        items:
                          type: object
                          properties:
                            sample_index:
                              type: integer
                            status:
                              type: boolean
                            single_value:
                              type: number
                            before_after_value:
                              type: object
                            qualitative_value:
                              type: boolean
                            pre_processing_formula_values:
                              type: array
                              nullable: true
                              description: Pre-processing formula results per sample
                              items:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: "normalized"
                                  formula:
                                    type: string
                                    example: "=single_value/cross_section"
                                  value:
                                    type: number
                                    nullable: true
                                    example: 2.304635761589328
                                  is_show:
                                    type: boolean
                                    example: true
                      variable_values:
                        type: array
                        description: Complete variable values (FIXED, MANUAL, FORMULA)
                        items:
                          type: object
                          properties:
                            name_id:
                              type: string
                              example: "cross_section"
                            value:
                              type: number
                              nullable: true
                              description: Calculated value (null if dependencies not met)
                              example: 5.033333333333499
                      joint_setting_formula_values:
                        type: array
                        nullable: true
                        description: Joint formula results (if applicable)
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            formula:
                              type: string
                            is_final_value:
                              type: boolean
                            is_final:
                              type: boolean
                              description: Alternative field name
                            value:
                              type: number
                              nullable: true
                              description: Calculated value (null if formula fails)
                            error:
                              type: string
                              nullable: true
                              description: Error message if formula fails
              examples:
                simple_measurement:
                  summary: Simple measurement (no formulas)
                  value:
                    http_code: 200
                    message: "Samples processed successfully"
                    error_id: null
                    data:
                      measurement_item_name_id: "thickness_a"
                      status: true
                      samples:
                        - sample_index: 1
                          status: true
                          single_value: 10
                        - sample_index: 2
                          status: true
                          single_value: 10
                        - sample_index: 3
                          status: true
                          single_value: 10
                      variable_values: []
                      joint_setting_formula_values: null
                with_calculated_variables:
                  summary: Measurement with calculated variables
                  value:
                    http_code: 200
                    message: "Samples processed successfully"
                    error_id: null
                    data:
                      measurement_item_name_id: "room_temp"
                      status: true
                      samples:
                        - sample_index: 1
                          status: true
                          single_value: 25.5
                        - sample_index: 2
                          status: true
                          single_value: 25.3
                        - sample_index: 3
                          status: true
                          single_value: 25.7
                      variable_values:
                        - name: "CROSS_SECTION"
                          value: 10.0
                          status: "OK"
                      joint_setting_formula_values: null
                missing_dependencies:
                  summary: Formula with missing dependencies
                  value:
                    http_code: 200
                    message: "Samples processed successfully"
                    error_id: null
                    data:
                      measurement_item_name_id: "room_temp"
                      status: null
                      samples:
                        - sample_index: 1
                          status: null
                          single_value: 25.5
                      variable_values:
                        - name: "CROSS_SECTION"
                          value: null
                          status: "PENDING"
                      joint_setting_formula_values: null
        '404':
          description: Product measurement or measurement item not found
        '401':
          description: Unauthorized

  /v1/product-measurement/{productMeasurementId}/save-progress:
    post:
      tags:
        - Product Measurements
      summary: Save measurement progress
      description: |
        Save measurement progress to database.
        
        **IMPORTANT:** 
        - This endpoint validates data against "jejak" (last_check_data)
        - If validation fails (raw data changed or dependencies outdated), returns 400 error
        - Data will NOT be saved to database if there are validation warnings
        
        **Validation Checks:**
        - Level 1 (CRITICAL): Raw data changed but not re-checked via /samples/check
        - Level 2 (WARNING): Dependencies changed but dependent item not updated
        
        **Before calling this endpoint:**
        - Ensure all measurement items have been validated via /samples/check
        - If you changed raw data, re-hit /samples/check before save-progress
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
          description: Product measurement ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - measurement_results
              properties:
                measurement_results:
                  type: array
                  description: Array of measurement results to save
                  items:
                    type: object
                    required:
                      - measurement_item_name_id
                    properties:
                      measurement_item_name_id:
                        type: string
                        example: "thickness_a"
                      status:
                        type: boolean
                        description: Overall status (true = OK, false = NG)
                        example: true
                      samples:
                        type: array
                        nullable: true
                        description: Sample measurements (nullable for derived items with sample_amount = 0)
                        items:
                          type: object
                          properties:
                            sample_index:
                              type: integer
                              example: 1
                            status:
                              type: boolean
                              nullable: true
                              example: true
                            single_value:
                              type: number
                              nullable: true
                              example: 10.5
                            before_after_value:
                              type: object
                              nullable: true
                              properties:
                                before:
                                  type: number
                                after:
                                  type: number
                            qualitative_value:
                              type: boolean
                              nullable: true
                            pre_processing_formula_values:
                              type: array
                              nullable: true
                              items:
                                type: object
                                properties:
                                  name:
                                    type: string
                                  formula:
                                    type: string
                                  value:
                                    type: number
                                    nullable: true
                                  is_show:
                                    type: boolean
                      variable_values:
                        type: array
                        nullable: true
                        description: Variable values (FIXED, MANUAL, FORMULA)
                        items:
                          type: object
                          properties:
                            name_id:
                              type: string
                              example: "cross_section"
                            value:
                              type: number
                              example: 5.033333333333499
                      joint_setting_formula_values:
                        type: array
                        nullable: true
                        description: Joint formula results
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            formula:
                              type: string
                            is_final_value:
                              type: boolean
                            is_final:
                              type: boolean
                              description: Alternative field name (same as is_final_value)
                            value:
                              type: number
                              nullable: true
            examples:
              valid_save:
                summary: Valid save (will succeed)
                value:
                  measurement_results:
                    - measurement_item_name_id: "thickness_a"
                      status: true
                      samples:
                        - sample_index: 1
                          status: true
                          single_value: 10
                        - sample_index: 2
                          status: true
                          single_value: 10
                        - sample_index: 3
                          status: true
                          single_value: 10
                    - measurement_item_name_id: "room_temp"
                      status: true
                      samples:
                        - sample_index: 1
                          single_value: 25.5
                        - sample_index: 2
                          single_value: 25.3
                        - sample_index: 3
                          single_value: 25.7
                      variable_values:
                        - name: "CROSS_SECTION"
                          value: 10.0
              invalid_save_changed_data:
                summary: Invalid save (raw data changed, not re-checked)
                value:
                  measurement_results:
                    - measurement_item_name_id: "thickness_a"
                      status: true
                      samples:
                        - sample_index: 1
                          single_value: 50
                        - sample_index: 2
                          single_value: 10
                        - sample_index: 3
                          single_value: 30
      responses:
        '200':
          description: Progress saved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Progress saved successfully"
                  error_id:
                    type: string
                    nullable: true
                  data:
                    type: object
                    properties:
                      measurement_id:
                        type: string
                        example: "MSR-XXX"
                      status:
                        type: string
                        example: "IN_PROGRESS"
                      progress:
                        type: object
                        description: Progress calculation
                      saved_items:
                        type: integer
                        example: 2
                      total_saved_items:
                        type: integer
                        example: 4
              example:
                http_code: 200
                message: "Progress saved successfully"
                error_id: null
                data:
                  measurement_id: "MSR-7QG2XBOH"
                  status: "IN_PROGRESS"
                  progress:
                    completed_items: 2
                    total_items: 4
                    percentage: 50
                  saved_items: 2
                  total_saved_items: 2
        '400':
          description: Validation failed - data cannot be saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 400
                  message:
                    type: string
                    example: "Tidak dapat menyimpan progress karena ada data yang perlu di-validate ulang"
                  error_id:
                    type: string
                    example: "VALIDATION_REQUIRED"
                  data:
                    type: object
                    properties:
                      warnings:
                        type: array
                        items:
                          type: object
                          properties:
                            measurement_item_name_id:
                              type: string
                            level:
                              type: string
                              enum: [CRITICAL, WARNING]
                            reason:
                              type: string
                            action:
                              type: string
                            last_check_values:
                              type: array
                              items:
                                type: number
                            current_values:
                              type: array
                              items:
                                type: number
                            dependencies_changed:
                              type: array
                              items:
                                type: string
                            type:
                              type: string
                              enum: [RAW_DATA_CHANGED_NOT_VALIDATED, DEPENDENCY_CHANGED]
                      critical_count:
                        type: integer
                      dependency_count:
                        type: integer
              examples:
                critical_warning:
                  summary: Critical - Raw data changed
                  value:
                    http_code: 400
                    message: "Tidak dapat menyimpan progress karena ada data yang perlu di-validate ulang: 1 item dengan raw data berubah belum di-check ulang"
                    error_id: "VALIDATION_REQUIRED"
                    data:
                      warnings:
                        - measurement_item_name_id: "thickness_a"
                          level: "CRITICAL"
                          reason: "Raw data berubah dari hasil check terakhir tetapi belum di-validate ulang"
                          action: "Silakan hit endpoint /samples/check untuk item ini terlebih dahulu"
                          last_check_values: [10, 10, 10]
                          current_values: [50, 10, 30]
                          type: "RAW_DATA_CHANGED_NOT_VALIDATED"
                      critical_count: 1
                      dependency_count: 0
                chain_dependencies:
                  summary: Chain dependencies affected
                  value:
                    http_code: 400
                    message: "Tidak dapat menyimpan progress karena ada data yang perlu di-validate ulang: 1 item dengan raw data berubah belum di-check ulang, 3 item terpengaruh perubahan dependency"
                    error_id: "VALIDATION_REQUIRED"
                    data:
                      warnings:
                        - measurement_item_name_id: "thickness_a"
                          level: "CRITICAL"
                          reason: "Raw data berubah dari hasil check terakhir tetapi belum di-validate ulang"
                          last_check_values: [10, 10, 10]
                          current_values: [50, 10, 30]
                          type: "RAW_DATA_CHANGED_NOT_VALIDATED"
                        - measurement_item_name_id: "room_temp"
                          level: "WARNING"
                          reason: "Item ini bergantung pada thickness_a yang telah berubah atau terpengaruh perubahan, namun item ini belum di-check ulang"
                          action: "Silakan hit endpoint /samples/check untuk thickness_a terlebih dahulu, lalu hit untuk room_temp"
                          dependencies_changed: ["thickness_a"]
                          type: "DEPENDENCY_CHANGED"
                        - measurement_item_name_id: "final_temp"
                          level: "WARNING"
                          reason: "Item ini bergantung pada thickness_a yang telah berubah atau terpengaruh perubahan, namun item ini belum di-check ulang"
                          dependencies_changed: ["thickness_a"]
                          type: "DEPENDENCY_CHANGED"
                        - measurement_item_name_id: "fix_temp"
                          level: "WARNING"
                          reason: "Item ini bergantung pada room_temp, final_temp yang telah berubah atau terpengaruh perubahan, namun item ini belum di-check ulang"
                          dependencies_changed: ["room_temp", "final_temp"]
                          type: "DEPENDENCY_CHANGED"
                      critical_count: 1
                      dependency_count: 3
        '404':
          description: Product measurement not found
        '401':
          description: Unauthorized

  /v1/product-measurement/{productMeasurementId}/submit:
    post:
      tags:
        - Product Measurements
      summary: Submit measurement
      description: |
        Submit final measurement results. This endpoint:
        - Validates all data against last_check_data
        - Recalculates all formulas with complete context
        - Sets status to COMPLETED
        - Updates overall_result (OK/NG)
        - Sets submitted_at timestamp
        
        **IMPORTANT:** 
        - All measurement items must be validated via /samples/check before submit
        - If validation fails, returns 400 with warnings
        - Data is NOT saved if there are validation errors
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - measurement_results
              properties:
                measurement_results:
                  type: array
                  description: Array of measurement results (same structure as save-progress)
                  items:
                    type: object
                    required:
                      - measurement_item_name_id
                    properties:
                      measurement_item_name_id:
                        type: string
                      status:
                        type: boolean
                      samples:
                        type: array
                        nullable: true
                      variable_values:
                        type: array
                        nullable: true
                      joint_setting_formula_values:
                        type: array
                        nullable: true
      responses:
        '200':
          description: Measurement submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Measurement results processed successfully"
                  data:
                    type: object
                    properties:
                      status:
                        type: boolean
                        description: Overall status (true = OK, false = NG)
                      overall_result:
                        type: string
                        enum: [OK, NG]
                      submitted_at:
                        type: string
                        format: date-time
                        description: Timestamp when measurement was submitted
                      evaluation_summary:
                        type: object
                        properties:
                          total_items:
                            type: integer
                          passed_items:
                            type: integer
                          failed_items:
                            type: integer
                          pass_rate:
                            type: number
                          item_details:
                            type: array
                      samples:
                        type: array
                        description: Final processed measurement results with submitted_at timestamp
                        items:
                          type: object
                          properties:
                            measurement_item_name_id:
                              type: string
                            status:
                              type: boolean
                            variable_values:
                              type: array
                            samples:
                              type: array
                            joint_setting_formula_values:
                              type: array
                            created_at:
                              type: string
                              format: date-time
                            updated_at:
                              type: string
                              format: date-time
                            submitted_at:
                              type: string
                              format: date-time
                              description: Timestamp when this item was submitted
        '400':
          description: Validation failed - same validation errors as save-progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /v1/product-measurement/{productMeasurementId}/result:
    get:
      tags:
        - Product Measurements
      summary: Get measurement result
      description: Get detailed measurement result with evaluation summary
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Measurement result retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      measurement_id:
                        type: string
                      status:
                        type: string
                      overall_result:
                        type: boolean
                      evaluation_summary:
                        type: object
                      measurement_results:
                        type: array

  /v1/product-measurement/{productMeasurementId}/create-sample-product:
    post:
      tags:
        - Product Measurements
      summary: Create sample product
      description: Create a sample product from measurement results
      parameters:
        - name: productMeasurementId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                product_category_id:
                  type: integer
                  description: Target product category for sample product
      responses:
        '201':
          description: Sample product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # Notification Endpoints
  /v1/notifications:
    get:
      tags:
        - Notifications
      summary: Get notifications list
      description: Get paginated list of notifications for current user
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: read
          in: query
          schema:
            type: boolean
          description: Filter by read status
      responses:
        '200':
          description: Notifications retrieved successfully
    delete:
      tags:
        - Notifications
      summary: Delete notification
      description: Delete a specific notification
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Notification deleted successfully
  /v1/notifications/unread-count:
    get:
      tags:
        - Notifications
      summary: Get unread notifications count
      description: Get count of unread notifications for current user
      responses:
        '200':
          description: Unread count retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  http_code:
                    type: integer
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      unread_count:
                        type: integer
                        example: 5
  /v1/notifications/{id}/mark-as-read:
    post:
      tags:
        - Notifications
      summary: Mark notification as read
      description: Mark a specific notification as read
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Notification marked as read
  /v1/notifications/mark-all-as-read:
    post:
      tags:
        - Notifications
      summary: Mark all notifications as read
      description: Mark all notifications for current user as read
      responses:
        '200':
          description: All notifications marked as read
  /v1/notifications/all-read:
    delete:
      tags:
        - Notifications
      summary: Delete all read notifications
      description: Delete all read notifications for current user
      responses:
        '200':
          description: All read notifications deleted successfully

  # Measurement Endpoints (Legacy/Demo)
  /v1/measurements:
    post:
      tags:
        - Measurements
      summary: Store measurement data
      description: Store measurement data (legacy endpoint)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Measurement stored successfully

  /v1/measurements/{id}:
    get:
      tags:
        - Measurements
      summary: Get measurement with calculated result
      description: Get measurement with formula calculations
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Measurement retrieved successfully

  /v1/measurements/{id}/process-formula:
    post:
      tags:
        - Measurements
      summary: Process formula
      description: Calculate formula result for measurement
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                formula:
                  type: string
                  example: '=avg(thickness_a)'
      responses:
        '200':
          description: Formula processed successfully
