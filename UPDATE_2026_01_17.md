# Update 17 Januari 2026

## Ringkasan Perubahan

Dokumen ini menjelaskan perubahan yang dilakukan pada sistem SyncFlow pada tanggal 17 Januari 2026. Terdapat 3 perubahan utama yang dilakukan.

---

## 1. Perbaikan Endpoint `/reports/data` - Exclude SKIP_CHECK dari Summary Todo

### Masalah
Endpoint `/reports/data` menghitung semua measurement item dengan status `null` sebagai `todo` di summary, termasuk item yang memiliki `evaluation_type` = `SKIP_CHECK`. Padahal item dengan `SKIP_CHECK` seharusnya tidak dihitung sebagai todo karena memang tidak perlu di-check.

### Solusi
Endpoint sekarang mengecek `evaluation_type` dari setiap measurement point. Jika `evaluation_type` adalah `SKIP_CHECK`, maka item tersebut tidak akan dihitung dalam `summary.todo`, meskipun statusnya `null`.

### Endpoint Terpengaruh
- **GET** `/api/v1/reports/data`

### Parameter
- `quarter` (required): Quarter number (1-4)
- `year` (required): Tahun
- `product_id` (required): ID produk
- `batch_number` (required): Nomor batch

### Response Structure
Response tetap sama, namun perhitungan `summary.todo` sekarang sudah benar:
- `summary.todo`: Hanya menghitung item yang benar-benar belum diukur (bukan SKIP_CHECK)

### Contoh Kasus
Sebelumnya, jika ada 3 measurement item dengan `SKIP_CHECK` (diameter_wire_x, diameter_wire_y, berat), ketiganya akan masuk ke `summary.todo`. Sekarang, ketiga item tersebut tidak akan dihitung dalam `summary.todo`.

---

## 2. Penambahan Filter `category_id` dan Search Query

### Perubahan
Tiga endpoint `available-products` sekarang mendukung filter berdasarkan `category_id` dan pencarian menggunakan parameter `query`.

### Endpoint yang Diupdate

#### 2.1. `/product-measurement/available-products`
**Method:** GET  
**Deskripsi:** Mendapatkan daftar produk yang tersedia untuk membuat target bulanan baru (belum punya measurement di quarter yang dipilih)

**Parameter Baru:**
- `category_id` (optional): Filter berdasarkan ID kategori produk
- `query` (optional): Pencarian berdasarkan nama produk, product_spec_name, product_id, article_code, atau ref_spec_number

**Parameter Existing:**
- `quarter` (required): Quarter number (1-4)
- `year` (required): Tahun
- `page` (optional): Nomor halaman
- `limit` (optional): Jumlah item per halaman

#### 2.2. `/reports/filters/products`
**Method:** GET  
**Deskripsi:** Mendapatkan daftar produk yang memiliki measurement di quarter tertentu (untuk filter di halaman reports)

**Parameter Baru:**
- `category_id` (optional): Filter berdasarkan ID kategori produk
- `query` (optional): Pencarian berdasarkan nama produk, product_spec_name, product_id, article_code, atau ref_spec_number

**Parameter Existing:**
- `quarter` (required): Quarter number (1-4)
- `year` (required): Tahun

#### 2.3. `/scale-measurement/available-products`
**Method:** GET  
**Deskripsi:** Mendapatkan daftar produk yang tersedia untuk membuat scale measurement baru (belum punya measurement di tanggal tertentu)

**Parameter Baru:**
- `category_id` (optional): Filter berdasarkan ID kategori produk
- `query` (optional): Pencarian berdasarkan nama produk, product_spec_name, product_id, article_code, atau ref_spec_number

**Parameter Existing:**
- `date` (required): Tanggal measurement
- `page` (optional): Nomor halaman
- `limit` (optional): Jumlah item per halaman

### Catatan Penting
- Filter `category_id` dan `query` bersifat optional, sehingga tidak akan mempengaruhi behavior existing jika tidak digunakan
- Pencarian `query` akan mencari di field: `product_spec_name`, `product_name`, `product_id`, `article_code`, dan `ref_spec_number`
- Filter `category_id` harus sesuai dengan ID yang ada di tabel `product_categories`

---

## 3. Penambahan Field `device_id` pada Tools

### Perubahan
Field baru `device_id` ditambahkan ke semua endpoint terkait tools. Field ini bersifat optional (nullable) dan dapat digunakan untuk menyimpan identifier device tambahan selain IMEI.

### Endpoint yang Diupdate

#### 3.1. GET `/api/v1/tools`
**Method:** GET  
**Deskripsi:** Mendapatkan daftar semua tools

**Perubahan:**
- Response sekarang termasuk field `device_id`
- Parameter `search` sekarang juga mencari di field `device_id`

**Response Field Baru:**
- `device_id`: String, nullable

#### 3.2. GET `/api/v1/tools/{id}`
**Method:** GET  
**Deskripsi:** Mendapatkan detail tool berdasarkan ID

**Perubahan:**
- Response sekarang termasuk field `device_id`

**Response Field Baru:**
- `device_id`: String, nullable

#### 3.3. POST `/api/v1/tools`
**Method:** POST  
**Deskripsi:** Membuat tool baru

**Request Body Baru:**
- `device_id` (optional): String, maksimal 255 karakter

**Response:**
- Response sekarang termasuk field `device_id` yang baru dibuat

#### 3.4. PUT `/api/v1/tools/{id}`
**Method:** PUT  
**Deskripsi:** Update tool yang sudah ada

**Request Body Baru:**
- `device_id` (optional): String, maksimal 255 karakter

**Response:**
- Response sekarang termasuk field `device_id` yang sudah diupdate

#### 3.5. GET `/api/v1/tools/overdue-calibration`
**Method:** GET  
**Deskripsi:** Mendapatkan tools yang overdue calibration

**Perubahan:**
- Response sekarang termasuk field `deviceId` (camelCase untuk konsistensi dengan response format endpoint ini)

**Response Field Baru:**
- `deviceId`: String, nullable

### Database Migration
- Migration file: `2026_01_17_100000_add_device_id_to_tools_table.php`
- Kolom `device_id` ditambahkan ke tabel `tools` dengan tipe `string` nullable
- Posisi kolom: setelah kolom `imei`

### Catatan Penting
- Field `device_id` bersifat optional, sehingga tools yang sudah ada tidak perlu diupdate
- Field ini berbeda dengan `imei` - `imei` tetap required dan unique, sedangkan `device_id` adalah identifier tambahan yang optional
- Saat melakukan search di endpoint GET `/api/v1/tools`, pencarian akan mencakup `device_id` juga

---

## Testing Recommendations

### 1. Testing `/reports/data` dengan SKIP_CHECK
- Test dengan product yang memiliki measurement items dengan `evaluation_type` = `SKIP_CHECK`
- Pastikan `summary.todo` tidak menghitung item SKIP_CHECK meskipun statusnya `null`
- Verifikasi bahwa item SKIP_CHECK tetap muncul di `measurement_items` dengan status `null`

### 2. Testing Filter `category_id` dan `query`
- Test semua tiga endpoint `available-products` dengan parameter `category_id`
- Test dengan parameter `query` untuk memastikan pencarian bekerja dengan baik
- Test kombinasi `category_id` dan `query` bersamaan
- Pastikan behavior existing tetap bekerja jika parameter baru tidak digunakan

### 3. Testing `device_id` pada Tools
- Test create tool baru dengan `device_id`
- Test update tool existing dengan `device_id`
- Test search dengan `device_id`
- Pastikan tools yang sudah ada (tanpa `device_id`) tetap berfungsi normal
- Verifikasi semua endpoint tools mengembalikan `device_id` di response

---

## Migration Instructions

Untuk menerapkan perubahan database (penambahan `device_id` pada tabel `tools`), jalankan migration:

```bash
php artisan migrate
```

Migration file yang akan dijalankan:
- `2026_01_17_100000_add_device_id_to_tools_table.php`

**Catatan:** Pastikan untuk backup database sebelum menjalankan migration.

---

## Breaking Changes

Tidak ada breaking changes pada update ini. Semua perubahan bersifat backward compatible:
- Parameter baru (`category_id`, `query`, `device_id`) bersifat optional
- Response structure tetap sama, hanya menambahkan field baru
- Behavior existing tetap sama jika parameter baru tidak digunakan

---

## Summary

1. ✅ Fixed: `/reports/data` endpoint sekarang tidak menghitung SKIP_CHECK items sebagai todo
2. ✅ Added: Filter `category_id` dan search `query` pada 3 endpoint `available-products`
3. ✅ Added: Field `device_id` pada semua endpoint tools (CRUD operations)

Semua perubahan telah diimplementasikan dan siap untuk testing.
